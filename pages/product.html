<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <title>Products Display</title>
  </head>
  <body>
    <div id="main-container">
      <nav
        class="navbar navbar-expand-lg navbar-light bg-light"
        style="position: sticky; top: 0; z-index: 1"
      >
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Navbar</a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Service</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Contact</a>
              </li>
            </ul>
            <form class="d-flex">
              <input
                class="form-control me-2"
                type="search"
                placeholder="Search"
                aria-label="Search"
              />
              <button class="btn btn-outline-success" type="submit">
                Search
              </button>
              <button class="btn btn-outline-primary ms-2">Logout</button>
            </form>
          </div>
        </div>
      </nav>

      <!-- Add Button -->
      <div class="container">
        <button
          type="button"
          class="btn btn-primary mt-3"
          data-bs-toggle="modal"
          data-bs-target="#staticBackdrop"
        >
          Add Product
        </button>

        <!--Add Modal -->
        <div
          class="modal fade"
          id="staticBackdrop"
          data-bs-backdrop="static"
          data-bs-keyboard="false"
          tabindex="-1"
          aria-labelledby="staticBackdropLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">
                  Add Product Form
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <form action="">
                  <div class="form-floating mb-3">
                    <input
                      type="text"
                      id="add-img"
                      class="form-control"
                      placeholder="Enter Image URL"
                    />
                    <label for="add-img">Product Image URL</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input
                      type="text"
                      id="add-title"
                      class="form-control"
                      placeholder="Enter Product Title"
                    />
                    <label for="add-title">Product Title</label>
                  </div>

                  <div class="row mb-3">
                    <div class="col-6">
                      <div class="form-floating">
                        <input
                          type="number"
                          id="add-price"
                          placeholder="Enter Product Price"
                          class="form-control"
                        />
                        <label for="add-price">Product Price</label>
                      </div>
                    </div>

                    <div class="col-6">
                      <div class="form-floating">
                        <input
                          type="text"
                          id="add-category"
                          placeholder="Enter Product Category"
                          class="form-control"
                        />
                        <label for="add-category">Product Category</label>
                      </div>
                    </div>
                  </div>

                  <div class="form-floating mb-3">
                    <textarea
                      id="add-desc"
                      cols="30"
                      rows="10"
                      placeholder="Enter Description"
                      class="form-control"
                    ></textarea>
                    <label for="add-desc">Product Description</label>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                  id="close-btn"
                >
                  Close
                </button>
                <button
                  type="button"
                  class="btn btn-primary"
                  onclick="addProduct(event)"
                >
                  Add Product
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container mt-3" id="container"></div>
    </div>

    <script>
      let actualProduct = [];

      const getProducts = async () => {
        const response = await fetch("https://dummyjson.com/products");

        const { products } = await response.json();
        console.log(products);

        actualProduct = products;
        //console.log(actualProduct);
        newProducts(products);
      };

      getProducts();

      const newProducts = (products) => {
        container.innerHTML = "";
        for (let product of products) {
          //console.log(product);

          const container = document.getElementById("container");
          container.classList.add("d-flex", "flex-wrap", "gap-5");

          const card = document.createElement("div");
          card.style.width = "22%";
          card.style.height = "400px";
          card.className = "card";

          const cardHeader = document.createElement("div");
          cardHeader.className = "card-header h-75";

          const cardImg = document.createElement("img");
          cardImg.src = product.thumbnail;
          cardImg.className = "w-100 h-100";

          cardHeader.append(cardImg);
          card.append(cardHeader);

          const cardBody = document.createElement("div");

          const cardTitle = document.createElement("h5");
          cardTitle.innerText =
            product.title.length > 15
              ? product.title.slice(0, 14) + "..."
              : product.title;
          cardTitle.className = "text-center";

          const cardP = document.createElement("p");
          cardP.innerText =
            product.description.length > 30
              ? product.description.slice(0, 29) + "...."
              : product.description;
          cardP.className = "text-center";

          card.append(cardBody);
          cardBody.append(cardTitle);
          cardBody.append(cardP);

          const cardFooter = document.createElement("div");

          const viewBtn = document.createElement("button");
          viewBtn.innerText = "View Details";
          viewBtn.className = "btn btn-outline-primary btn-sm m-2";

          const editBtn = document.createElement("button");
          editBtn.innerText = "Edit Detail";
          editBtn.className = "btn btn-outline-success btn-sm m-2";

          const deleteBtn = document.createElement("button");
          deleteBtn.innerText = "Delete";
          deleteBtn.className = "btn btn-outline-danger btn-sm m-2";

          deleteBtn.addEventListener("click", (e) => {
            e.preventDefault();

            console.log(product.id);

            const filteredProduct = products.filter((prod) => {
              //console.log(prod);

              return prod.id !== product.id;
            });

            //console.log(filteredProduct);

            newProducts(filteredProduct);
          });

          card.append(cardFooter);
          cardFooter.append(viewBtn);
          cardFooter.append(editBtn);
          cardFooter.append(deleteBtn);
          container.append(card);
        }
      };

      function addProduct(e) {
        e.preventDefault();
        console.log("clicked");
        const ImageURL = document.getElementById("add-img").value;
        const title = document.getElementById("add-title").value;
        const price = document.getElementById("add-price").value;
        const category = document.getElementById("add-category").value;
        const description = document.getElementById("add-desc").value;

        //console.log(ImageURL, title, price, category, description);

        const newData = {
          id: Date.now(),
          thumbnail: ImageURL,
          title: title,
          price,
          category,
          description,
        };
        //console.log(actualProduct);
        //console.log([newData, ...actualProduct]);
        newProducts([newData, ...actualProduct]);
        document.getElementById("close-btn").click();
      }

      addProduct();
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
